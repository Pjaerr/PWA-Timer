let ss = 0, mm = 0, hh = 0, isEnabled = !1; function timerPostData(a, b) { return { type: a, value: b } } function timer() { isEnabled && (ss += 1, 60 <= ss && (ss = 0, mm += 1, 60 <= mm && (hh += 1, mm = 0, postMessage(timerPostData('hh', hh))), postMessage(timerPostData('mm', mm))), postMessage(timerPostData('ss', ss))), setTimeout('timer()', 1e3) } timer(), onmessage = function (a) { 'state_change' === a.data[0] ? isEnabled = a.data[1] : 'update_from_storage' === a.data[0] ? (hh = a.data[1], mm = a.data[2], ss = a.data[3]) : 'reset' === a.data[0] && (ss = 0, mm = 0, hh = 0) };